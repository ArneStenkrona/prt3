<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>

    <!-- Create the canvas that the C++ code will draw into -->
    <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>

    <script src="FileSaver.js"> </script>
    <script>
        function downloadFileFromMemory(memoryFSname, downloadName)
        {
           var data=FS.readFile(memoryFSname);
           var blob;
           var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
           if(isSafari) {
              blob = new Blob([data.buffer], {type: "application/octet-stream"});
           } else {
              blob = new Blob([data.buffer], {type: "application/octet-binary"});
           }
           saveAs(blob, downloadName);
        }

        function saveFileFromMemoryFSToResourceFolder(memoryFSname,localFSname)
        {
            var data=FS.readFile(memoryFSname);
            var blob;
            var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            if(isSafari) {
                blob = new Blob([data.buffer], {type: "application/octet-stream"});
            } else {
                blob = new Blob([data.buffer], {type: "application/octet-binary"});
            }

            var loc = window.location.pathname;
            var dir = loc.substring(0, loc.lastIndexOf('/'));
            var path = dir + '/' + localFSname
            fetch('http://localhost:8000/' + path, {method:"PUT", body:blob})
            .then(response => {
                if (response.ok) return response;
                else throw Error(`Server returned ${response.status}: ${response.statusText}`)
            })
            .then(response => console.log(response.text()))
            .catch(err => {
                alert(err);
            });
        }
    </script>

    <!-- Allow the C++ to access the canvas element -->
    <script type='text/javascript'>
        var canv = document.getElementById('canvas');
        var Module = {
            canvas: canv
        };

    </script>

    <script src="prt3.js"></script>
</body>

</html>
